<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" />
  <title>Tap-The-Color</title>
  <style>
    :root{--size:72px}
    body{display:flex;align-items:center;justify-content:center;height:100vh;margin:0;font-family:system-ui,Segoe UI,Arial;background:#f3f6fb}
    .card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,.08);text-align:center;width:320px}
    h1{font-size:18px;margin:0 0 8px;color:#2b6cb0}
    .hud{display:flex;justify-content:space-between;margin-bottom:10px;font-weight:700;color:#333}
    .target{display:inline-flex;gap:8px;align-items:center}
    .dot{width:18px;height:18px;border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.12)}
    .grid{display:grid;grid-template-columns:repeat(3,var(--size));gap:10px;justify-content:center;margin:8px 0}
    .tile{width:var(--size);height:var(--size);border-radius:10px;cursor:pointer;box-shadow:0 6px 18px rgba(2,6,23,.08);border:3px solid transparent;transition:transform .08s}
    .tile:active{transform:scale(.96)}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:#555}
    button.small{padding:6px 10px;border-radius:8px;border:none;background:#2b6cb0;color:#fff;cursor:pointer}
    .msg{font-weight:700;color:#2b6cb0}
    button.tile:focus{outline:3px solid rgba(43,108,176,0.18)}
  </style>
</head>
<body>
  <div class="card" role="application" aria-labelledby="title">
    <h1 id="title">Tap-The-Color</h1>

    <div class="hud">
      <div>Score: <span id="score">0</span></div>
      <div class="target" role="group" aria-label="Target color">
        Target: <div id="target-dot" class="dot" title="Target color"></div>
      </div>
      <div>Time: <span id="time">10</span>s</div>
    </div>

    <div id="grid" class="grid" role="grid" aria-label="Color grid"></div>

    <div class="footer">
      <div class="msg" id="msg" aria-live="polite"></div>
      <button id="start" class="small" title="Start the game">Start</button>
    </div>
  </div>

<script>
(() => {
  const COLORS = ["#ff6b6b","#ffb86b","#ffd56b","#6bd6a9","#4b7bec","#9b7bff"];
  const grid = document.getElementById("grid");
  const targetDot = document.getElementById("target-dot");
  const scoreEl = document.getElementById("score");
  const timeEl = document.getElementById("time");
  const msg = document.getElementById("msg");
  const startBtn = document.getElementById("start");

  let target = "";
  let score = 0;
  let timerId = null;
  let timeLeft = 10;

  function makeGrid(){
    grid.innerHTML = "";
    for(let i=0;i<9;i++){
      const b = document.createElement("button");
      b.className = "tile";
      b.setAttribute("type","button");
      b.setAttribute("aria-label", `color tile ${i+1}`);
      b.dataset.idx = i;
      b.addEventListener("click", onTileClick);
      grid.appendChild(b);
    }
  }

  function pickTarget(){
    target = COLORS[Math.floor(Math.random()*COLORS.length)];
    targetDot.style.backgroundColor = target;
    targetDot.setAttribute("aria-label", `target color ${target}`);
  }

  function fillTiles(){
    const tiles = Array.from(grid.children);
    tiles.forEach(t => {
      const col = COLORS[Math.floor(Math.random()*COLORS.length)];
      t.style.backgroundColor = col;
      t.style.borderColor = "transparent";
    });
    // ensure at least one correct tile
    const correctIndex = Math.floor(Math.random()*tiles.length);
    tiles[correctIndex].style.backgroundColor = target;
  }

  function rgbToHex(rgbString){
    if(!rgbString) return "";
    // handle hex input already set (style.backgroundColor may already be hex in some browsers)
    if(rgbString[0] === "#") return rgbString.toLowerCase();
    const nums = rgbString.match(/\d+/g);
    if(!nums || nums.length < 3) return "";
    const [r,g,b] = nums.map(Number);
    return "#" + [r,g,b].map(x => x.toString(16).padStart(2,'0')).join('').toLowerCase();
  }

  function onTileClick(e){
    if(!timerId) return;
    const clickedStyle = e.currentTarget.style.backgroundColor || e.currentTarget.style.background;
    const color = rgbToHex(clickedStyle);
    // debug: console.log("Clicked:", color, "Target:", target);
    if(color === target.toLowerCase()){
      score++;
      scoreEl.textContent = score;
      showFlash(e.currentTarget, true);
      nextRound();
    } else {
      showFlash(e.currentTarget, false);
      timeLeft = Math.max(1, timeLeft - 2);
      updateTime();
    }
  }

  function showFlash(el, good){
    el.style.borderColor = good ? "#16a34a" : "#ef4444";
    setTimeout(()=> el.style.borderColor = "transparent", 250);
  }

  function updateTime(){
    timeEl.textContent = timeLeft;
  }

  function tick(){
    timeLeft--;
    updateTime();
    if(timeLeft <= 0){
      endGame();
    }
  }

  function startGame(){
    clearInterval(timerId);
    score = 0;
    scoreEl.textContent = score;
    timeLeft = 10;
    updateTime();
    pickTarget();
    fillTiles();
    msg.textContent = "";
    startBtn.disabled = true;
    startBtn.setAttribute("aria-pressed","true");
    // start ticking
    timerId = setInterval(tick, 1000);
  }

  function nextRound(){
    pickTarget();
    fillTiles();
  }

  function endGame(){
    clearInterval(timerId);
    timerId = null;
    msg.textContent = `Game over â€” Score ${score}`;
    startBtn.disabled = false;
    startBtn.setAttribute("aria-pressed","false");
  }

  // initialize
  makeGrid();
  pickTarget();
  fillTiles();
  updateTime();

  startBtn.addEventListener("click", startGame);
})();
</script>
</body>
</html>
